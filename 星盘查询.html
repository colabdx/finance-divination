
<!DOCTYPE html>
<html lang="zh-CN">
<head><script src="https://lf-cdn.coze.cn/obj/unpkg/coze-webapp/console-bridge/0.0.1-alpha.b2eb33/dist/index.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿç›˜æŸ¥è¯¢ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .input-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .input-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-query {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-query:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-query:active {
            transform: translateY(0);
        }

        .results-section {
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            background: #f8f9fa;
            border: none;
            font-size: 1em;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab:hover:not(.active) {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .planet-name {
            font-weight: 600;
            color: #333;
        }

        .zodiac-sign {
            color: #667eea;
            font-weight: 600;
        }

        .house {
            color: #764ba2;
        }

        .degree {
            color: #555;
        }

        .aspect-type {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .aspect-conjunction {
            background: #ff6b6b;
            color: white;
        }

        .aspect-opposition {
            background: #4ecdc4;
            color: white;
        }

        .aspect-trine {
            background: #45b7d1;
            color: white;
        }

        .aspect-square {
            background: #ff9f43;
            color: white;
        }

        .aspect-sextile {
            background: #2ecc71;
            color: white;
        }

        .aspect-150 {
            background: #9b59b6;
            color: white;
        }

        .aspect-semisextile {
            background: #f39c12;
            color: white;
        }

        .error-message {
            background: #fee;
            border: 1px solid #fcc;
            border-radius: 8px;
            padding: 15px;
            color: #c33;
            margin-top: 20px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            th, td {
                padding: 10px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âœ¨ æ˜Ÿç›˜æŸ¥è¯¢ç³»ç»Ÿ âœ¨</h1>
            <p>è¾“å…¥æ‚¨çš„å‡ºç”Ÿä¿¡æ¯ï¼Œæ¢ç´¢æ‚¨çš„å‘½ç›˜å¥¥ç§˜ï¼ˆæ¯æ¬¡æŸ¥è¯¢ç”Ÿæˆéšæœºæ•°æ®ï¼‰</p>
        </div>

        <div class="content">
            <div class="input-section">
                <h2>ğŸ“ å‡ºç”Ÿä¿¡æ¯è¾“å…¥</h2>
                <div class="form-group">
                    <label for="birthDate">å‡ºç”Ÿæ—¥æœŸ (YYYY-MM-DD)</label>
                    <input type="date" id="birthDate" required>
                </div>
                <div class="form-group">
                    <label for="birthTime">å‡ºç”Ÿæ—¶é—´ (HH:MM)</label>
                    <input type="time" id="birthTime" required>
                </div>
                <div class="form-group">
                    <label for="birthPlace">å‡ºç”Ÿåœ°ç‚¹</label>
                    <input type="text" id="birthPlace" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬" required>
                </div>
                <button class="btn-query" onclick="queryChart()">ğŸ”® æŸ¥è¯¢æ˜Ÿç›˜</button>
                <div id="errorMessage" class="error-message"></div>
            </div>

            <div id="loading" class="loading">
                <div class="loading-spinner"></div>
                <p>æ­£åœ¨è®¡ç®—æ‚¨çš„æ˜Ÿç›˜...</p>
            </div>

            <div id="resultsSection" class="results-section">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('planets')">ğŸŒŸ è¡Œæ˜Ÿä¿¡æ¯</button>
                    <button class="tab" onclick="switchTab('aspects')">ğŸ”— ç›¸ä½ä¿¡æ¯</button>
                </div>

                <div id="planetsTab" class="tab-content active">
                    <table id="planetsTable">
                        <thead>
                            <tr>
                                <th>è¡Œæ˜Ÿ</th>
                                <th>æ˜Ÿåº§</th>
                                <th>å®«ä½</th>
                                <th>åº¦æ•°</th>
                            </tr>
                        </thead>
                        <tbody id="planetsBody"></tbody>
                    </table>
                </div>

                <div id="aspectsTab" class="tab-content">
                    <table id="aspectsTable">
                        <thead>
                            <tr>
                                <th>è¡Œæ˜Ÿ1</th>
                                <th>è¡Œæ˜Ÿ2</th>
                                <th>ç›¸ä½</th>
                                <th>è§£é‡Š</th>
                            </tr>
                        </thead>
                        <tbody id="aspectsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€é”™è¯¯å¤„ç†
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('JavaScripté”™è¯¯:', message, 'at', source, lineno);
            showError('ç³»ç»Ÿå‘ç”Ÿé”™è¯¯: ' + message);
            return true;
        };

        // å®‰å…¨çš„DOMå…ƒç´ è·å–å‡½æ•°
        function safeGetElement(id) {
            try {
                if (!id || typeof id !== 'string') {
                    console.error('æ— æ•ˆçš„å…ƒç´ ID:', id);
                    return null;
                }
                const el = document.getElementById(id);
                if (!el) {
                    console.error(`å…ƒç´  ${id} æœªæ‰¾åˆ°`);
                    return null;
                }
                return el;
            } catch (e) {
                console.error('è·å–å…ƒç´ å¤±è´¥:', e);
                return null;
            }
        }

        // æ˜Ÿåº§åˆ—è¡¨
        const zodiacSigns = [
            "ç™½ç¾Šåº§", "é‡‘ç‰›åº§", "åŒå­åº§", "å·¨èŸ¹åº§", 
            "ç‹®å­åº§", "å¤„å¥³åº§", "å¤©ç§¤åº§", "å¤©èåº§", 
            "å°„æ‰‹åº§", "æ‘©ç¾¯åº§", "æ°´ç“¶åº§", "åŒé±¼åº§"
        ];

        // å®«ä½åˆ—è¡¨
        const houses = [
            "ç¬¬ä¸€å®«", "ç¬¬äºŒå®«", "ç¬¬ä¸‰å®«", "ç¬¬å››å®«",
            "ç¬¬äº”å®«", "ç¬¬å…­å®«", "ç¬¬ä¸ƒå®«", "ç¬¬å…«å®«",
            "ç¬¬ä¹å®«", "ç¬¬åå®«", "ç¬¬åä¸€å®«", "ç¬¬åäºŒå®«"
        ];

        // è¡Œæ˜Ÿåˆ—è¡¨
        const planets = [
            "å¤ªé˜³", "æœˆäº®", "æ°´æ˜Ÿ", "é‡‘æ˜Ÿ", "ç«æ˜Ÿ",
            "æœ¨æ˜Ÿ", "åœŸæ˜Ÿ", "å¤©ç‹æ˜Ÿ", "æµ·ç‹æ˜Ÿ", "å†¥ç‹æ˜Ÿ",
            "å‡¯é¾™æ˜Ÿ", "è°·ç¥æ˜Ÿ", "æ™ºç¥æ˜Ÿ", "å©šç¥æ˜Ÿ", "ç¶ç¥æ˜Ÿ",
            "åŒ—äº¤ç‚¹", "è‰è‰ä¸", "ç¦ç‚¹", "å®¿å‘½ç‚¹", "ä¸œå‡ç‚¹"
        ];

        // ç›¸ä½ç±»å‹åˆ—è¡¨
        const aspectTypes = ["åˆç›¸", "å¯¹åˆ†ç›¸", "ä¸‰åˆç›¸", "å››åˆ†ç›¸", "å…­åˆç›¸", "150åº¦ç›¸ä½", "æ‹±ç›¸ä½"];

        // ç›¸ä½è§£é‡Šæ¨¡æ¿
        const aspectExplanations = {
            "åˆç›¸": ["ä¸¤è€…èƒ½é‡èåˆï¼Œå½¢æˆå¼ºå¤§çš„å½±å“åŠ›", "ä»£è¡¨æ–°çš„å¼€å§‹å’Œèåˆçš„èƒ½é‡", "å¼ºåŒ–å½¼æ­¤çš„ç‰¹è´¨å’Œè¡¨ç°"],
            "å¯¹åˆ†ç›¸": ["å­˜åœ¨å†…åœ¨å¼ åŠ›ï¼Œéœ€è¦å¯»æ‰¾å¹³è¡¡", "ä»£è¡¨å¯¹æä¹‹é—´çš„å†²çªä¸æ•´åˆ", "éœ€è¦åœ¨ä¸¤è‚¡åŠ›é‡é—´å¯»æ‰¾å¹³è¡¡ç‚¹"],
            "ä¸‰åˆç›¸": ["å’Œè°æµç•…çš„èƒ½é‡æµåŠ¨", "å¤©èµ‹ä¸èƒ½åŠ›çš„é¡ºåˆ©è¡¨è¾¾", "ä»£è¡¨æœºé‡å’Œç§¯æçš„å‘å±•"],
            "å››åˆ†ç›¸": ["ä»£è¡¨æŒ‘æˆ˜å’Œæˆé•¿çš„æœºä¼š", "éœ€è¦å…‹æœçš„å†…åœ¨å†²çª", "é€šè¿‡åŠªåŠ›å¯ä»¥è½¬åŒ–ä¸ºåŠ¨åŠ›"],
            "å…­åˆç›¸": ["æ¸©å’Œè€Œæœ‰åˆ©çš„ç›¸ä½", "å¸¦æ¥å’Œè°ä¸åˆä½œçš„æœºä¼š", "è½»æ¾å‘æŒ¥å„è‡ªçš„æ½œèƒ½"],
            "150åº¦ç›¸ä½": ["å‰ä¸–çš„å…³ç³»ä¸ä¸šåŠ›è¿æ¥", "çµé­‚æ·±å¤„çš„è®°å¿†ä¸ç¼˜åˆ†", "ä»è¿‡å»ç”Ÿå‘½å¸¦æ¥çš„è¯¾é¢˜ä¸ç¤¼ç‰©", "éœ€è¦åŒ–è§£çš„å‰ä¸–ä¸šåŠ›"],
            "æ‹±ç›¸ä½": ["åº¦æ•°ç›¸å·®5-8åº¦çš„å¾®ç»†ç›¸ä½ï¼Œæ½œè—çš„æœºé‡", "ç»†å¾®ä½†æŒç»­çš„å†…åœ¨å½±å“ï¼Œéœ€è¦ç»†å¿ƒè§‰å¯Ÿ", "ä»£è¡¨ç»†å¾®çš„æˆé•¿å¥‘æœºå’Œèƒ½é‡å…±æŒ¯", "éœ€è¦è€å¿ƒåŸ¹å…»çš„æ½œåœ¨å¯èƒ½æ€§"]
        };

        // éšæœºæ•°ç”Ÿæˆå‡½æ•°
        function getRandomInt(min, max) {
            if (typeof min !== 'number' || typeof max !== 'number') {
                console.error(' getRandomInt: æ— æ•ˆçš„å‚æ•°', min, max);
                return 0;
            }
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // ä»æ•°ç»„ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ 
        function getRandomElement(array) {
            if (!array || !Array.isArray(array) || array.length === 0) {
                console.error('getRandomElement: æ— æ•ˆçš„æ•°ç»„', array);
                return '';
            }
            return array[getRandomInt(0, array.length - 1)];
        }

        // æ˜Ÿç›˜æ•°æ®è®¡ç®—å‡½æ•°ï¼ˆç”Ÿæˆéšæœºæ•°æ®ï¼‰
        function calculateNatalChart(birthDate, birthTime, birthPlace) {
            try {
                const result = {};

                // ä¸ºæ¯ä¸ªè¡Œæ˜Ÿç”Ÿæˆéšæœºä½ç½®
                if (Array.isArray(planets)) {
                    for (const planet of planets) {
                        if (planet && typeof planet === 'string') {
                            result[planet] = {
                                "æ˜Ÿåº§": getRandomElement(zodiacSigns),
                                "å®«ä½": getRandomElement(houses),
                                "åº¦æ•°": Math.random() * 30  // 0-30åº¦
                            };
                        }
                    }
                }

                // ç”Ÿæˆéšæœºç›¸ä½ï¼ˆé€‰æ‹©5-8ä¸ªéšæœºè¡Œæ˜Ÿå¯¹ï¼‰
                const aspects = [];
                const numAspects = getRandomInt(5, 8);
                const usedPairs = new Set();

                let attempts = 0;
                const maxAttempts = 100;

                while (aspects.length < numAspects && attempts < maxAttempts) {
                    attempts++;
                    
                    const planet1 = getRandomElement(planets);
                    const planet2 = getRandomElement(planets);

                    // ç¡®ä¿ä¸æ˜¯åŒä¸€ä¸ªè¡Œæ˜Ÿ
                    if (planet1 === planet2 || !planet1 || !planet2) continue;

                    // åˆ›å»ºå”¯ä¸€é”®æ¥é¿å…é‡å¤
                    const pairKey = [planet1, planet2].sort().join('-');
                    if (usedPairs.has(pairKey)) continue;
                    usedPairs.add(pairKey);

                    const phase = getRandomElement(aspectTypes);
                    const explanations = aspectExplanations[phase];
                    
                    if (explanations && Array.isArray(explanations) && explanations.length > 0) {
                        aspects.push({
                            "è¡Œæ˜Ÿ1": planet1,
                            "è¡Œæ˜Ÿ2": planet2,
                            "ç›¸ä½": phase,
                            "è§£é‡Š": getRandomElement(explanations)
                        });
                    }
                }

                return { planets: result, aspects: aspects };
            } catch (e) {
                console.error('è®¡ç®—æ˜Ÿç›˜å¤±è´¥:', e);
                throw e;
            }
        }

        // è·å–ç›¸ä½æ ·å¼ç±»
        function getAspectClass(phase) {
            try {
                if (!phase || typeof phase !== 'string') {
                    return '';
                }
                const aspectClasses = {
                    "åˆç›¸": "aspect-conjunction",
                    "å¯¹åˆ†ç›¸": "aspect-opposition",
                    "ä¸‰åˆç›¸": "aspect-trine",
                    "å››åˆ†ç›¸": "aspect-square",
                    "å…­åˆç›¸": "aspect-sextile",
                    "150åº¦ç›¸ä½": "aspect-150",
                    "æ‹±ç›¸ä½": "aspect-semisextile"
                };
                const className = aspectClasses[phase];
                return className || "";
            } catch (e) {
                console.error('è·å–ç›¸ä½æ ·å¼å¤±è´¥:', e);
                return '';
            }
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            try {
                const tabs = document.querySelectorAll('.tab');
                const tabContents = document.querySelectorAll('.tab-content');

                if (tabs && Array.isArray(tabs) && tabs.length > 0) {
                    tabs.forEach(tab => {
                        if (tab && typeof tab.classList !== 'undefined') {
                            tab.classList.remove('active');
                        }
                    });
                }

                if (tabContents && Array.isArray(tabContents) && tabContents.length > 0) {
                    tabContents.forEach(content => {
                        if (content && typeof content.classList !== 'undefined') {
                            content.classList.remove('active');
                        }
                    });
                }

                if (tabName === 'planets') {
                    if (tabs && tabs[0]) {
                        tabs[0].classList.add('active');
                    }
                    const planetsTab = safeGetElement('planetsTab');
                    if (planetsTab && typeof planetsTab.classList !== 'undefined') {
                        planetsTab.classList.add('active');
                    }
                } else {
                    if (tabs && tabs[1]) {
                        tabs[1].classList.add('active');
                    }
                    const aspectsTab = safeGetElement('aspectsTab');
                    if (aspectsTab && typeof aspectsTab.classList !== 'undefined') {
                        aspectsTab.classList.add('active');
                    }
                }
            } catch (e) {
                console.error('åˆ‡æ¢æ ‡ç­¾é¡µå¤±è´¥:', e);
                showError('åˆ‡æ¢æ ‡ç­¾é¡µå¤±è´¥');
            }
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            try {
                const errorEl = safeGetElement('errorMessage');
                if (errorEl && typeof errorEl.classList !== 'undefined') {
                    errorEl.textContent = message || 'å‘ç”ŸæœªçŸ¥é”™è¯¯';
                    errorEl.classList.add('show');
                    setTimeout(() => {
                        if (errorEl.classList) {
                            errorEl.classList.remove('show');
                        }
                    }, 5000);
                } else {
                    console.error('æ— æ³•æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯:', message);
                }
            } catch (e) {
                console.error('æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯å¤±è´¥:', e);
                alert(message || 'å‘ç”ŸæœªçŸ¥é”™è¯¯');
            }
        }

        // æŸ¥è¯¢æ˜Ÿç›˜
        function queryChart() {
            try {
                const birthDateEl = safeGetElement('birthDate');
                const birthTimeEl = safeGetElement('birthTime');
                const birthPlaceEl = safeGetElement('birthPlace');

                if (!birthDateEl || !birthTimeEl || !birthPlaceEl) {
                    showError('è¡¨å•å…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }

                const birthDate = birthDateEl.value;
                const birthTime = birthTimeEl.value;
                const birthPlace = birthPlaceEl.value;

                if (!birthDate || !birthTime || !birthPlace) {
                    showError('è¯·å®Œæ•´å¡«å†™å‡ºç”Ÿæ—¥æœŸã€æ—¶é—´å’Œåœ°ç‚¹ï¼');
                    return;
                }

                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const loadingEl = safeGetElement('loading');
                const resultsSectionEl = safeGetElement('resultsSection');
                
                if (loadingEl && typeof loadingEl.classList !== 'undefined') {
                    loadingEl.classList.add('show');
                }
                if (resultsSectionEl && typeof resultsSectionEl.classList !== 'undefined') {
                    resultsSectionEl.classList.remove('active');
                }

                // æ¨¡æ‹Ÿè®¡ç®—å»¶è¿Ÿ
                setTimeout(() => {
                    try {
                        const result = calculateNatalChart(birthDate, birthTime, birthPlace);
                        const planets = result && result.planets ? result.planets : {};
                        const aspects = result && result.aspects ? result.aspects : [];

                        // å¡«å……è¡Œæ˜Ÿè¡¨æ ¼
                        const planetsBody = safeGetElement('planetsBody');
                        if (planetsBody) {
                            planetsBody.innerHTML = '';
                            if (typeof Object.entries === 'function') {
                                for (const [planet, info] of Object.entries(planets)) {
                                    if (!info) continue;
                                    const row = document.createElement('tr');
                                    row.innerHTML = `
                                        <td class="planet-name">${planet || ''}</td>
                                        <td class="zodiac-sign">${info.æ˜Ÿåº§ || ''}</td>
                                        <td class="house">${info.å®«ä½ || ''}</td>
                                        <td class="degree">${typeof info.åº¦æ•° === 'number' ? info.åº¦æ•°.toFixed(1) + 'Â°' : ''}</td>
                                    `;
                                    planetsBody.appendChild(row);
                                }
                            }
                        }

                        // å¡«å……ç›¸ä½è¡¨æ ¼
                        const aspectsBody = safeGetElement('aspectsBody');
                        if (aspectsBody) {
                            aspectsBody.innerHTML = '';
                            if (Array.isArray(aspects)) {
                                for (const aspect of aspects) {
                                    if (!aspect) continue;
                                    const row = document.createElement('tr');
                                    row.innerHTML = `
                                        <td class="planet-name">${aspect.è¡Œæ˜Ÿ1 || ''}</td>
                                        <td class="planet-name">${aspect.è¡Œæ˜Ÿ2 || ''}</td>
                                        <td><span class="aspect-type ${getAspectClass(aspect.ç›¸ä½)}">${aspect.ç›¸ä½ || ''}</span></td>
                                        <td>${aspect.è§£é‡Š || ''}</td>
                                    `;
                                    aspectsBody.appendChild(row);
                                }
                            }
                        }

                        // æ˜¾ç¤ºç»“æœ
                        if (loadingEl && typeof loadingEl.classList !== 'undefined') {
                            loadingEl.classList.remove('show');
                        }
                        if (resultsSectionEl && typeof resultsSectionEl.classList !== 'undefined') {
                            resultsSectionEl.classList.add('active');
                        }

                    } catch (e) {
                        console.error('å¤„ç†æŸ¥è¯¢ç»“æœå¤±è´¥:', e);
                        if (loadingEl && typeof loadingEl.classList !== 'undefined') {
                            loadingEl.classList.remove('show');
                        }
                        showError('è®¡ç®—æ˜Ÿç›˜æ—¶å‘ç”Ÿé”™è¯¯: ' + e.message);
                    }
                }, 1000);

            } catch (e) {
                console.error('æŸ¥è¯¢æ˜Ÿç›˜å¤±è´¥:', e);
                showError('æŸ¥è¯¢æ˜Ÿç›˜å¤±è´¥: ' + e.message);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const birthDateEl = safeGetElement('birthDate');
                if (birthDateEl && typeof birthDateEl.value !== 'undefined') {
                    const today = new Date();
                    const year = today.getFullYear();
                    const month = String(today.getMonth() + 1).padStart(2, '0');
                    const day = String(today.getDate()).padStart(2, '0');
                    birthDateEl.value = `${year}-${month}-${day}`;
                }
            } catch (e) {
                console.error('åˆå§‹åŒ–é¡µé¢å¤±è´¥:', e);
            }
        });
    </script>
</body>
</html>
